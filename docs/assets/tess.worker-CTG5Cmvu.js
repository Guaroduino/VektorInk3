function I(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in e)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(e,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(e)}function H(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var x={},U=x;x.WINDING_ODD=0;x.WINDING_NONZERO=1;x.WINDING_POSITIVE=2;x.WINDING_NEGATIVE=3;x.WINDING_ABS_GEQ_TWO=4;x.POLYGONS=0;x.CONNECTED_POLYGONS=1;x.BOUNDARY_CONTOURS=2;x.tesselate=function(e){for(var t=e.debug||!1,n=new b,i=0;i<e.contours.length;i++)n.addContour(e.vertexSize||2,e.contours[i]);return n.tesselate(e.windingRule||x.WINDING_ODD,e.elementType||x.POLYGONS,e.polySize||3,e.vertexSize||2,e.normal||[0,0,1]),{vertices:n.vertices,vertexIndices:n.vertexIndices,vertexCount:n.vertexCount,elements:n.elements,elementCount:n.elementCount,mesh:t?n.mesh:void 0}};var h=function(e){if(!e)throw"Assertion Failed!"};function L(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}function y(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}function E(e){this.next=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Org=null,this.Lface=null,this.activeRegion=null,this.winding=0,this.side=e}E.prototype={get Rface(){return this.Sym.Lface},set Rface(e){this.Sym.Lface=e},get Dst(){return this.Sym.Org},set Dst(e){this.Sym.Org=e},get Oprev(){return this.Sym.Lnext},set Oprev(e){this.Sym.Lnext=e},get Lprev(){return this.Onext.Sym},set Lprev(e){this.Onext.Sym=e},get Dprev(){return this.Lnext.Sym},set Dprev(e){this.Lnext.Sym=e},get Rprev(){return this.Sym.Onext},set Rprev(e){this.Sym.Onext=e},get Dnext(){return this.Sym.Onext.Sym},set Dnext(e){this.Sym.Onext.Sym=e},get Rnext(){return this.Sym.Lnext.Sym},set Rnext(e){this.Sym.Lnext.Sym=e}};function R(){var e=new L,t=new y,n=new E(0),i=new E(1);e.next=e.prev=e,e.anEdge=null,t.next=t.prev=t,t.anEdge=null,t.trail=null,t.marked=!1,t.inside=!1,n.next=n,n.Sym=i,n.Onext=null,n.Lnext=null,n.Org=null,n.Lface=null,n.winding=0,n.activeRegion=null,i.next=i,i.Sym=n,i.Onext=null,i.Lnext=null,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,this.vHead=e,this.fHead=t,this.eHead=n,this.eHeadSym=i}R.prototype={makeEdge_:function(e){var t=new E(0),n=new E(1);e.Sym.side<e.side&&(e=e.Sym);var i=e.Sym.next;return n.next=i,i.Sym.next=t,t.next=e,e.Sym.next=n,t.Sym=n,t.Onext=t,t.Lnext=n,t.Org=null,t.Lface=null,t.winding=0,t.activeRegion=null,n.Sym=t,n.Onext=n,n.Lnext=t,n.Org=null,n.Lface=null,n.winding=0,n.activeRegion=null,t},splice_:function(e,t){var n=e.Onext,i=t.Onext;n.Sym.Lnext=t,i.Sym.Lnext=e,e.Onext=i,t.Onext=n},makeVertex_:function(e,t,n){var i=e;h(i!==null);var r=n.prev;i.prev=r,r.next=i,i.next=n,n.prev=i,i.anEdge=t;var a=t;do a.Org=i,a=a.Onext;while(a!==t)},makeFace_:function(e,t,n){var i=e;h(i!==null);var r=n.prev;i.prev=r,r.next=i,i.next=n,n.prev=i,i.anEdge=t,i.trail=null,i.marked=!1,i.inside=n.inside;var a=t;do a.Lface=i,a=a.Lnext;while(a!==t)},killEdge_:function(e){e.Sym.side<e.side&&(e=e.Sym);var t=e.next,n=e.Sym.next;t.Sym.next=n,n.Sym.next=t},killVertex_:function(e,t){var n=e.anEdge,i=n;do i.Org=t,i=i.Onext;while(i!==n);var r=e.prev,a=e.next;a.prev=r,r.next=a},killFace_:function(e,t){var n=e.anEdge,i=n;do i.Lface=t,i=i.Lnext;while(i!==n);var r=e.prev,a=e.next;a.prev=r,r.next=a},makeEdge:function(){var e=new L,t=new L,n=new y,i=this.makeEdge_(this.eHead);return this.makeVertex_(e,i,this.vHead),this.makeVertex_(t,i.Sym,this.vHead),this.makeFace_(n,i,this.fHead),i},splice:function(e,t){var n=!1,i=!1;if(e!==t){if(t.Org!==e.Org&&(i=!0,this.killVertex_(t.Org,e.Org)),t.Lface!==e.Lface&&(n=!0,this.killFace_(t.Lface,e.Lface)),this.splice_(t,e),!i){var r=new L;this.makeVertex_(r,t,e.Org),e.Org.anEdge=e}if(!n){var a=new y;this.makeFace_(a,t,e.Lface),e.Lface.anEdge=e}}},delete:function(e){var t=e.Sym,n=!1;if(e.Lface!==e.Rface&&(n=!0,this.killFace_(e.Lface,e.Rface)),e.Onext===e)this.killVertex_(e.Org,null);else if(e.Rface.anEdge=e.Oprev,e.Org.anEdge=e.Onext,this.splice_(e,e.Oprev),!n){var i=new y;this.makeFace_(i,e,e.Lface)}t.Onext===t?(this.killVertex_(t.Org,null),this.killFace_(t.Lface,null)):(e.Lface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev)),this.killEdge_(e)},addEdgeVertex:function(e){var t=this.makeEdge_(e),n=t.Sym;this.splice_(t,e.Lnext),t.Org=e.Dst;var i=new L;return this.makeVertex_(i,n,t.Org),t.Lface=n.Lface=e.Lface,t},splitEdge:function(e,t){var n=this.addEdgeVertex(e),i=n.Sym;return this.splice_(e.Sym,e.Sym.Oprev),this.splice_(e.Sym,i),e.Dst=i.Org,i.Dst.anEdge=i.Sym,i.Rface=e.Rface,i.winding=e.winding,i.Sym.winding=e.Sym.winding,i},connect:function(e,t){var n=!1,i=this.makeEdge_(e),r=i.Sym;if(t.Lface!==e.Lface&&(n=!0,this.killFace_(t.Lface,e.Lface)),this.splice_(i,e.Lnext),this.splice_(r,t),i.Org=e.Dst,r.Org=t.Org,i.Lface=r.Lface=e.Lface,e.Lface.anEdge=r,!n){var a=new y;this.makeFace_(a,i,e.Lface)}return i},zapFace:function(e){var t=e.anEdge,n,i,r,a,o;i=t.Lnext;do n=i,i=n.Lnext,n.Lface=null,n.Rface===null&&(n.Onext===n?this.killVertex_(n.Org,null):(n.Org.anEdge=n.Onext,this.splice_(n,n.Oprev)),r=n.Sym,r.Onext===r?this.killVertex_(r.Org,null):(r.Org.anEdge=r.Onext,this.splice_(r,r.Oprev)),this.killEdge_(n));while(n!=t);a=e.prev,o=e.next,o.prev=a,a.next=o},countFaceVerts_:function(e){var t=e.anEdge,n=0;do n++,t=t.Lnext;while(t!==e.anEdge);return n},mergeConvexFaces:function(e){var t,n,i,r,a,o,s;for(t=this.fHead.next;t!==this.fHead;t=t.next)if(t.inside)for(n=t.anEdge,a=n.Org;i=n.Lnext,r=n.Sym,r&&r.Lface&&r.Lface.inside&&(o=this.countFaceVerts_(t),s=this.countFaceVerts_(r.Lface),o+s-2<=e&&f.vertCCW(n.Lprev.Org,n.Org,r.Lnext.Lnext.Org)&&f.vertCCW(r.Lprev.Org,r.Org,n.Lnext.Lnext.Org)&&(i=r.Lnext,this.delete(r),n=null,r=null)),!(n&&n.Lnext.Org===a);)n=i;return!0},check:function(){var e=this.fHead,t=this.vHead,n=this.eHead,i,r,a,o,s,d;for(r=e,r=e;(i=r.next)!==e;r=i){h(i.prev===r),s=i.anEdge;do h(s.Sym!==s),h(s.Sym.Sym===s),h(s.Lnext.Onext.Sym===s),h(s.Onext.Sym.Lnext===s),h(s.Lface===i),s=s.Lnext;while(s!==i.anEdge)}for(h(i.prev===r&&i.anEdge===null),o=t,o=t;(a=o.next)!==t;o=a){h(a.prev===o),s=a.anEdge;do h(s.Sym!==s),h(s.Sym.Sym===s),h(s.Lnext.Onext.Sym===s),h(s.Onext.Sym.Lnext===s),h(s.Org===a),s=s.Onext;while(s!==a.anEdge)}for(h(a.prev===o&&a.anEdge===null),d=n,d=n;(s=d.next)!==n;d=s)h(s.Sym.next===d.Sym),h(s.Sym!==s),h(s.Sym.Sym===s),h(s.Org!==null),h(s.Dst!==null),h(s.Lnext.Onext.Sym===s),h(s.Onext.Sym.Lnext===s);h(s.Sym.next===d.Sym&&s.Sym===this.eHeadSym&&s.Sym.Sym===s&&s.Org===null&&s.Dst===null&&s.Lface===null&&s.Rface===null)}};var f={};f.vertEq=function(e,t){return e.s===t.s&&e.t===t.t};f.vertLeq=function(e,t){return e.s<t.s||e.s===t.s&&e.t<=t.t};f.transLeq=function(e,t){return e.t<t.t||e.t===t.t&&e.s<=t.s};f.edgeGoesLeft=function(e){return f.vertLeq(e.Dst,e.Org)};f.edgeGoesRight=function(e){return f.vertLeq(e.Org,e.Dst)};f.vertL1dist=function(e,t){return Math.abs(e.s-t.s)+Math.abs(e.t-t.t)};f.edgeEval=function(e,t,n){h(f.vertLeq(e,t)&&f.vertLeq(t,n));var i=t.s-e.s,r=n.s-t.s;return i+r>0?i<r?t.t-e.t+(e.t-n.t)*(i/(i+r)):t.t-n.t+(n.t-e.t)*(r/(i+r)):0};f.edgeSign=function(e,t,n){h(f.vertLeq(e,t)&&f.vertLeq(t,n));var i=t.s-e.s,r=n.s-t.s;return i+r>0?(t.t-n.t)*i+(t.t-e.t)*r:0};f.transEval=function(e,t,n){h(f.transLeq(e,t)&&f.transLeq(t,n));var i=t.t-e.t,r=n.t-t.t;return i+r>0?i<r?t.s-e.s+(e.s-n.s)*(i/(i+r)):t.s-n.s+(n.s-e.s)*(r/(i+r)):0};f.transSign=function(e,t,n){h(f.transLeq(e,t)&&f.transLeq(t,n));var i=t.t-e.t,r=n.t-t.t;return i+r>0?(t.s-n.s)*i+(t.s-e.s)*r:0};f.vertCCW=function(e,t,n){return e.s*(t.t-n.t)+t.s*(n.t-e.t)+n.s*(e.t-t.t)>=0};f.interpolate=function(e,t,n,i){return e=e<0?0:e,n=n<0?0:n,e<=n?n==0?(t+i)/2:t+(i-t)*(e/(e+n)):i+(t-i)*(n/(e+n))};f.intersect=function(e,t,n,i,r){var a,o,s;f.vertLeq(e,t)||(s=e,e=t,t=s),f.vertLeq(n,i)||(s=n,n=i,i=s),f.vertLeq(e,n)||(s=e,e=n,n=s,s=t,t=i,i=s),f.vertLeq(n,t)?f.vertLeq(t,i)?(a=f.edgeEval(e,n,t),o=f.edgeEval(n,t,i),a+o<0&&(a=-a,o=-o),r.s=f.interpolate(a,n.s,o,t.s)):(a=f.edgeSign(e,n,t),o=-f.edgeSign(e,i,t),a+o<0&&(a=-a,o=-o),r.s=f.interpolate(a,n.s,o,i.s)):r.s=(n.s+t.s)/2,f.transLeq(e,t)||(s=e,e=t,t=s),f.transLeq(n,i)||(s=n,n=i,i=s),f.transLeq(e,n)||(s=e,e=n,n=s,s=t,t=i,i=s),f.transLeq(n,t)?f.transLeq(t,i)?(a=f.transEval(e,n,t),o=f.transEval(n,t,i),a+o<0&&(a=-a,o=-o),r.t=f.interpolate(a,n.t,o,t.t)):(a=f.transSign(e,n,t),o=-f.transSign(e,i,t),a+o<0&&(a=-a,o=-o),r.t=f.interpolate(a,n.t,o,i.t)):r.t=(n.t+t.t)/2};function _(){this.key=null,this.next=null,this.prev=null}function N(e,t){this.head=new _,this.head.next=this.head,this.head.prev=this.head,this.frame=e,this.leq=t}N.prototype={min:function(){return this.head.next},max:function(){return this.head.prev},insert:function(e){return this.insertBefore(this.head,e)},search:function(e){var t=this.head;do t=t.next;while(t.key!==null&&!this.leq(this.frame,e,t.key));return t},insertBefore:function(e,t){do e=e.prev;while(e.key!==null&&!this.leq(this.frame,e.key,t));var n=new _;return n.key=t,n.next=e.next,e.next.prev=n,n.prev=e,e.next=n,n},delete:function(e){e.next.prev=e.prev,e.prev.next=e.next}};function D(){this.handle=null}function k(){this.key=null,this.node=null}function q(e,t){this.size=0,this.max=e,this.nodes=[],this.nodes.length=e+1;for(var n=0;n<this.nodes.length;n++)this.nodes[n]=new D;this.handles=[],this.handles.length=e+1;for(var n=0;n<this.handles.length;n++)this.handles[n]=new k;this.initialized=!1,this.freeList=0,this.leq=t,this.nodes[1].handle=1,this.handles[1].key=null}q.prototype={floatDown_:function(e){var t=this.nodes,n=this.handles,i,r,a;for(i=t[e].handle;;){if(a=e<<1,a<this.size&&this.leq(n[t[a+1].handle].key,n[t[a].handle].key)&&++a,h(a<=this.max),r=t[a].handle,a>this.size||this.leq(n[i].key,n[r].key)){t[e].handle=i,n[i].node=e;break}t[e].handle=r,n[r].node=e,e=a}},floatUp_:function(e){var t=this.nodes,n=this.handles,i,r,a;for(i=t[e].handle;;){if(a=e>>1,r=t[a].handle,a==0||this.leq(n[r].key,n[i].key)){t[e].handle=i,n[i].node=e;break}t[e].handle=r,n[r].node=e,e=a}},init:function(){for(var e=this.size;e>=1;--e)this.floatDown_(e);this.initialized=!0},min:function(){return this.handles[this.nodes[1].handle].key},isEmpty:function(){this.size},insert:function(e){var t,n;if(t=++this.size,t*2>this.max){this.max*=2;var i;i=this.nodes.length,this.nodes.length=this.max+1;for(var r=i;r<this.nodes.length;r++)this.nodes[r]=new D;i=this.handles.length,this.handles.length=this.max+1;for(var r=i;r<this.handles.length;r++)this.handles[r]=new k}return this.freeList===0?n=t:(n=this.freeList,this.freeList=this.handles[n].node),this.nodes[t].handle=n,this.handles[n].node=t,this.handles[n].key=e,this.initialized&&this.floatUp_(t),n},extractMin:function(){var e=this.nodes,t=this.handles,n=e[1].handle,i=t[n].key;return this.size>0&&(e[1].handle=e[this.size].handle,t[e[1].handle].node=1,t[n].key=null,t[n].node=this.freeList,this.freeList=n,--this.size,this.size>0&&this.floatDown_(1)),i},delete:function(e){var t=this.nodes,n=this.handles,i;h(e>=1&&e<=this.max&&n[e].key!==null),i=n[e].node,t[i].handle=t[this.size].handle,n[t[i].handle].node=i,--this.size,i<=this.size&&(i<=1||this.leq(n[t[i>>1].handle].key,n[t[i].handle].key)?this.floatDown_(i):this.floatUp_(i)),n[e].key=null,n[e].node=this.freeList,this.freeList=e}};function w(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}var l={};l.regionBelow=function(e){return e.nodeUp.prev.key};l.regionAbove=function(e){return e.nodeUp.next.key};l.debugEvent=function(e){};l.addWinding=function(e,t){e.winding+=t.winding,e.Sym.winding+=t.Sym.winding};l.edgeLeq=function(e,t,n){var i=e.event,o,s,r=t.eUp,a=n.eUp;if(r.Dst===i)return a.Dst===i?f.vertLeq(r.Org,a.Org)?f.edgeSign(a.Dst,r.Org,a.Org)<=0:f.edgeSign(r.Dst,a.Org,r.Org)>=0:f.edgeSign(a.Dst,i,a.Org)<=0;if(a.Dst===i)return f.edgeSign(r.Dst,i,r.Org)>=0;var o=f.edgeEval(r.Dst,i,r.Org),s=f.edgeEval(a.Dst,i,a.Org);return o>=s};l.deleteRegion=function(e,t){t.fixUpperEdge&&h(t.eUp.winding===0),t.eUp.activeRegion=null,e.dict.delete(t.nodeUp)};l.fixUpperEdge=function(e,t,n){h(t.fixUpperEdge),e.mesh.delete(t.eUp),t.fixUpperEdge=!1,t.eUp=n,n.activeRegion=t};l.topLeftRegion=function(e,t){var n=t.eUp.Org,i;do t=l.regionAbove(t);while(t.eUp.Org===n);if(t.fixUpperEdge){if(i=e.mesh.connect(l.regionBelow(t).eUp.Sym,t.eUp.Lnext),i===null)return null;l.fixUpperEdge(e,t,i),t=l.regionAbove(t)}return t};l.topRightRegion=function(n){var t=n.eUp.Dst,n=null;do n=l.regionAbove(n);while(n.eUp.Dst===t);return n};l.addRegionBelow=function(e,t,n){var i=new w;return i.eUp=n,i.nodeUp=e.dict.insertBefore(t.nodeUp,i),i.fixUpperEdge=!1,i.sentinel=!1,i.dirty=!1,n.activeRegion=i,i};l.isWindingInside=function(e,t){switch(e.windingRule){case x.WINDING_ODD:return(t&1)!=0;case x.WINDING_NONZERO:return t!=0;case x.WINDING_POSITIVE:return t>0;case x.WINDING_NEGATIVE:return t<0;case x.WINDING_ABS_GEQ_TWO:return t>=2||t<=-2}return h(!1),!1};l.computeWinding=function(e,t){t.windingNumber=l.regionAbove(t).windingNumber+t.eUp.winding,t.inside=l.isWindingInside(e,t.windingNumber)};l.finishRegion=function(e,t){var n=t.eUp,i=n.Lface;i.inside=t.inside,i.anEdge=n,l.deleteRegion(e,t)};l.finishLeftRegions=function(e,t,n){for(var i,o,r=null,a=t,o=t.eUp;a!==n;){if(a.fixUpperEdge=!1,r=l.regionBelow(a),i=r.eUp,i.Org!=o.Org){if(!r.fixUpperEdge){l.finishRegion(e,a);break}i=e.mesh.connect(o.Lprev,i.Sym),l.fixUpperEdge(e,r,i)}o.Onext!==i&&(e.mesh.splice(i.Oprev,i),e.mesh.splice(o,i)),l.finishRegion(e,a),o=r.eUp,a=r}return o};l.addRightEdges=function(e,t,n,i,r,a){var o,s,d,g,u=!0;d=n;do h(f.vertLeq(d.Org,d.Dst)),l.addRegionBelow(e,t,d.Sym),d=d.Onext;while(d!==i);for(r===null&&(r=l.regionBelow(t).eUp.Rprev),s=t,g=r;o=l.regionBelow(s),d=o.eUp.Sym,d.Org===g.Org;)d.Onext!==g&&(e.mesh.splice(d.Oprev,d),e.mesh.splice(g.Oprev,d)),o.windingNumber=s.windingNumber-d.winding,o.inside=l.isWindingInside(e,o.windingNumber),s.dirty=!0,!u&&l.checkForRightSplice(e,s)&&(l.addWinding(d,g),l.deleteRegion(e,s),e.mesh.delete(g)),u=!1,s=o,g=d;s.dirty=!0,h(s.windingNumber-d.winding===o.windingNumber),a&&l.walkDirtyRegions(e,s)};l.spliceMergeVertices=function(e,t,n){e.mesh.splice(t,n)};l.vertexWeights=function(e,t,n){var i=f.vertL1dist(t,e),r=f.vertL1dist(n,e),a=.5*r/(i+r),o=.5*i/(i+r);e.coords[0]+=a*t.coords[0]+o*n.coords[0],e.coords[1]+=a*t.coords[1]+o*n.coords[1],e.coords[2]+=a*t.coords[2]+o*n.coords[2]};l.getIntersectData=function(e,t,n,i,r,a){t.coords[0]=t.coords[1]=t.coords[2]=0,t.idx=-1,l.vertexWeights(t,n,i),l.vertexWeights(t,r,a)};l.checkForRightSplice=function(e,t){var n=l.regionBelow(t),i=t.eUp,r=n.eUp;if(f.vertLeq(i.Org,r.Org)){if(f.edgeSign(r.Dst,i.Org,r.Org)>0)return!1;f.vertEq(i.Org,r.Org)?i.Org!==r.Org&&(e.pq.delete(i.Org.pqHandle),l.spliceMergeVertices(e,r.Oprev,i)):(e.mesh.splitEdge(r.Sym),e.mesh.splice(i,r.Oprev),t.dirty=n.dirty=!0)}else{if(f.edgeSign(i.Dst,r.Org,i.Org)<0)return!1;l.regionAbove(t).dirty=t.dirty=!0,e.mesh.splitEdge(i.Sym),e.mesh.splice(r.Oprev,i)}return!0};l.checkForLeftSplice=function(e,t){var n=l.regionBelow(t),i=t.eUp,r=n.eUp,a;if(h(!f.vertEq(i.Dst,r.Dst)),f.vertLeq(i.Dst,r.Dst)){if(f.edgeSign(i.Dst,r.Dst,i.Org)<0)return!1;l.regionAbove(t).dirty=t.dirty=!0,a=e.mesh.splitEdge(i),e.mesh.splice(r.Sym,a),a.Lface.inside=t.inside}else{if(f.edgeSign(r.Dst,i.Dst,r.Org)>0)return!1;t.dirty=n.dirty=!0,a=e.mesh.splitEdge(r),e.mesh.splice(i.Lnext,r.Sym),a.Rface.inside=t.inside}return!0};l.checkForIntersect=function(e,t){var n=l.regionBelow(t),i=t.eUp,r=n.eUp,a=i.Org,o=r.Org,s=i.Dst,d=r.Dst,g,u,c=new L,m,p;if(h(!f.vertEq(d,s)),h(f.edgeSign(s,e.event,a)<=0),h(f.edgeSign(d,e.event,o)>=0),h(a!==e.event&&o!==e.event),h(!t.fixUpperEdge&&!n.fixUpperEdge),a===o||(g=Math.min(a.t,s.t),u=Math.max(o.t,d.t),g>u))return!1;if(f.vertLeq(a,o)){if(f.edgeSign(d,a,o)>0)return!1}else if(f.edgeSign(s,o,a)<0)return!1;return l.debugEvent(e),f.intersect(s,a,d,o,c),h(Math.min(a.t,s.t)<=c.t),h(c.t<=Math.max(o.t,d.t)),h(Math.min(d.s,s.s)<=c.s),h(c.s<=Math.max(o.s,a.s)),f.vertLeq(c,e.event)&&(c.s=e.event.s,c.t=e.event.t),m=f.vertLeq(a,o)?a:o,f.vertLeq(m,c)&&(c.s=m.s,c.t=m.t),f.vertEq(c,a)||f.vertEq(c,o)?(l.checkForRightSplice(e,t),!1):!f.vertEq(s,e.event)&&f.edgeSign(s,e.event,c)>=0||!f.vertEq(d,e.event)&&f.edgeSign(d,e.event,c)<=0?d===e.event?(e.mesh.splitEdge(i.Sym),e.mesh.splice(r.Sym,i),t=l.topLeftRegion(e,t),i=l.regionBelow(t).eUp,l.finishLeftRegions(e,l.regionBelow(t),n),l.addRightEdges(e,t,i.Oprev,i,i,!0),TRUE):s===e.event?(e.mesh.splitEdge(r.Sym),e.mesh.splice(i.Lnext,r.Oprev),n=t,t=l.topRightRegion(t),p=l.regionBelow(t).eUp.Rprev,n.eUp=r.Oprev,r=l.finishLeftRegions(e,n,null),l.addRightEdges(e,t,r.Onext,i.Rprev,p,!0),!0):(f.edgeSign(s,e.event,c)>=0&&(l.regionAbove(t).dirty=t.dirty=!0,e.mesh.splitEdge(i.Sym),i.Org.s=e.event.s,i.Org.t=e.event.t),f.edgeSign(d,e.event,c)<=0&&(t.dirty=n.dirty=!0,e.mesh.splitEdge(r.Sym),r.Org.s=e.event.s,r.Org.t=e.event.t),!1):(e.mesh.splitEdge(i.Sym),e.mesh.splitEdge(r.Sym),e.mesh.splice(r.Oprev,i),i.Org.s=c.s,i.Org.t=c.t,i.Org.pqHandle=e.pq.insert(i.Org),l.getIntersectData(e,i.Org,a,s,o,d),l.regionAbove(t).dirty=t.dirty=n.dirty=!0,!1)};l.walkDirtyRegions=function(e,t){for(var n=l.regionBelow(t),i,r;;){for(;n.dirty;)t=n,n=l.regionBelow(n);if(!t.dirty&&(n=t,t=l.regionAbove(t),t==null||!t.dirty))return;if(t.dirty=!1,i=t.eUp,r=n.eUp,i.Dst!==r.Dst&&l.checkForLeftSplice(e,t)&&(n.fixUpperEdge?(l.deleteRegion(e,n),e.mesh.delete(r),n=l.regionBelow(t),r=n.eUp):t.fixUpperEdge&&(l.deleteRegion(e,t),e.mesh.delete(i),t=l.regionAbove(n),i=t.eUp)),i.Org!==r.Org)if(i.Dst!==r.Dst&&!t.fixUpperEdge&&!n.fixUpperEdge&&(i.Dst===e.event||r.Dst===e.event)){if(l.checkForIntersect(e,t))return}else l.checkForRightSplice(e,t);i.Org===r.Org&&i.Dst===r.Dst&&(l.addWinding(r,i),l.deleteRegion(e,t),e.mesh.delete(i),t=l.regionAbove(n))}};l.connectRightVertex=function(e,t,n){var i,r=n.Onext,a=l.regionBelow(t),o=t.eUp,s=a.eUp,d=!1;if(o.Dst!==s.Dst&&l.checkForIntersect(e,t),f.vertEq(o.Org,e.event)&&(e.mesh.splice(r.Oprev,o),t=l.topLeftRegion(e,t),r=l.regionBelow(t).eUp,l.finishLeftRegions(e,l.regionBelow(t),a),d=!0),f.vertEq(s.Org,e.event)&&(e.mesh.splice(n,s.Oprev),n=l.finishLeftRegions(e,a,null),d=!0),d){l.addRightEdges(e,t,n.Onext,r,r,!0);return}f.vertLeq(s.Org,o.Org)?i=s.Oprev:i=o,i=e.mesh.connect(n.Lprev,i),l.addRightEdges(e,t,i,i.Onext,i.Onext,!1),i.Sym.activeRegion.fixUpperEdge=!0,l.walkDirtyRegions(e,t)};l.connectLeftDegenerate=function(e,t,n){var i,r,a,o,s;if(i=t.eUp,f.vertEq(i.Org,n)){h(!1),l.spliceMergeVertices(e,i,n.anEdge);return}if(!f.vertEq(i.Dst,n)){e.mesh.splitEdge(i.Sym),t.fixUpperEdge&&(e.mesh.delete(i.Onext),t.fixUpperEdge=!1),e.mesh.splice(n.anEdge,i),l.sweepEvent(e,n);return}h(!1),t=l.topRightRegion(t),s=l.regionBelow(t),a=s.eUp.Sym,r=o=a.Onext,s.fixUpperEdge&&(h(r!==a),l.deleteRegion(e,s),e.mesh.delete(a),a=r.Oprev),e.mesh.splice(n.anEdge,a),f.edgeGoesLeft(r)||(r=null),l.addRightEdges(e,t,a.Onext,o,r,!0)};l.connectLeftVertex=function(e,t){var n,i,r,a,o,s,d=new w;if(d.eUp=t.anEdge.Sym,n=e.dict.search(d).key,i=l.regionBelow(n),!!i){if(a=n.eUp,o=i.eUp,f.edgeSign(a.Dst,t,a.Org)===0){l.connectLeftDegenerate(e,n,t);return}if(r=f.vertLeq(o.Dst,a.Dst)?n:i,n.inside||r.fixUpperEdge){if(r===n)s=e.mesh.connect(t.anEdge.Sym,a.Lnext);else{var g=e.mesh.connect(o.Dnext,t.anEdge);s=g.Sym}r.fixUpperEdge?l.fixUpperEdge(e,r,s):l.computeWinding(e,l.addRegionBelow(e,n,s)),l.sweepEvent(e,t)}else l.addRightEdges(e,n,t.anEdge,t.anEdge,null,!0)}};l.sweepEvent=function(e,t){e.event=t,l.debugEvent(e);for(var n=t.anEdge;n.activeRegion===null;)if(n=n.Onext,n==t.anEdge){l.connectLeftVertex(e,t);return}var i=l.topLeftRegion(e,n.activeRegion);h(i!==null);var r=l.regionBelow(i),a=r.eUp,o=l.finishLeftRegions(e,r,null);o.Onext===a?l.connectRightVertex(e,i,o):l.addRightEdges(e,i,o.Onext,a,a,!0)};l.addSentinel=function(e,t,n,i){var r=new w,a=e.mesh.makeEdge();a.Org.s=n,a.Org.t=i,a.Dst.s=t,a.Dst.t=i,e.event=a.Dst,r.eUp=a,r.windingNumber=0,r.inside=!1,r.fixUpperEdge=!1,r.sentinel=!0,r.dirty=!1,r.nodeUp=e.dict.insert(r)};l.initEdgeDict=function(e){e.dict=new N(e,l.edgeLeq);var t=e.bmax[0]-e.bmin[0],n=e.bmax[1]-e.bmin[1],i=e.bmin[0]-t,r=e.bmax[0]+t,a=e.bmin[1]-n,o=e.bmax[1]+n;l.addSentinel(e,i,r,a),l.addSentinel(e,i,r,o)};l.doneEdgeDict=function(e){for(var t,n=0;(t=e.dict.min().key)!==null;)t.sentinel||(h(t.fixUpperEdge),h(++n==1)),h(t.windingNumber==0),l.deleteRegion(e,t)};l.removeDegenerateEdges=function(e){var t,n,i,r=e.mesh.eHead;for(t=r.next;t!==r;t=n)n=t.next,i=t.Lnext,f.vertEq(t.Org,t.Dst)&&t.Lnext.Lnext!==t&&(l.spliceMergeVertices(e,i,t),e.mesh.delete(t),t=i,i=t.Lnext),i.Lnext===t&&(i!==t&&((i===n||i===n.Sym)&&(n=n.next),e.mesh.delete(i)),(t===n||t===n.Sym)&&(n=n.next),e.mesh.delete(t))};l.initPriorityQ=function(e){var t,n,i,r=0;for(i=e.mesh.vHead,n=i.next;n!==i;n=n.next)r++;for(r+=8,t=e.pq=new q(r,f.vertLeq),i=e.mesh.vHead,n=i.next;n!==i;n=n.next)n.pqHandle=t.insert(n);return n!==i?!1:(t.init(),!0)};l.donePriorityQ=function(e){e.pq=null};l.removeDegenerateFaces=function(e,t){var n,i,r;for(n=t.fHead.next;n!==t.fHead;n=i)i=n.next,r=n.anEdge,h(r.Lnext!==r),r.Lnext.Lnext===r&&(l.addWinding(r.Onext,r),e.mesh.delete(r));return!0};l.computeInterior=function(e){var t,n;if(l.removeDegenerateEdges(e),!l.initPriorityQ(e))return!1;for(l.initEdgeDict(e);(t=e.pq.extractMin())!==null;){for(;n=e.pq.min(),!(n===null||!f.vertEq(n,t));)n=e.pq.extractMin(),l.spliceMergeVertices(e,t.anEdge,n.anEdge);l.sweepEvent(e,t)}return e.event=e.dict.min().key.eUp.Org,l.debugEvent(e),l.doneEdgeDict(e),l.donePriorityQ(e),l.removeDegenerateFaces(e,e.mesh)?(e.mesh.check(),!0):!1};function b(){this.mesh=null,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=x.WINDING_ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}b.prototype={dot_:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},normalize_:function(e){var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];h(t>0),t=Math.sqrt(t),e[0]/=t,e[1]/=t,e[2]/=t},longAxis_:function(e){var t=0;return Math.abs(e[1])>Math.abs(e[0])&&(t=1),Math.abs(e[2])>Math.abs(e[t])&&(t=2),t},computeNormal_:function(e){var t,n,i,r,a,o,s=[0,0,0],d=[0,0,0],g=[0,0,0],u=[0,0,0],c=[0,0,0],m=[null,null,null],p=[null,null,null],O=this.mesh.vHead,v;for(t=O.next,v=0;v<3;++v)r=t.coords[v],d[v]=r,p[v]=t,s[v]=r,m[v]=t;for(t=O.next;t!==O;t=t.next)for(v=0;v<3;++v)r=t.coords[v],r<d[v]&&(d[v]=r,p[v]=t),r>s[v]&&(s[v]=r,m[v]=t);if(v=0,s[1]-d[1]>s[0]-d[0]&&(v=1),s[2]-d[2]>s[v]-d[v]&&(v=2),d[v]>=s[v]){e[0]=0,e[1]=0,e[2]=1;return}for(o=0,n=p[v],i=m[v],g[0]=n.coords[0]-i.coords[0],g[1]=n.coords[1]-i.coords[1],g[2]=n.coords[2]-i.coords[2],t=O.next;t!==O;t=t.next)u[0]=t.coords[0]-i.coords[0],u[1]=t.coords[1]-i.coords[1],u[2]=t.coords[2]-i.coords[2],c[0]=g[1]*u[2]-g[2]*u[1],c[1]=g[2]*u[0]-g[0]*u[2],c[2]=g[0]*u[1]-g[1]*u[0],a=c[0]*c[0]+c[1]*c[1]+c[2]*c[2],a>o&&(o=a,e[0]=c[0],e[1]=c[1],e[2]=c[2]);o<=0&&(e[0]=e[1]=e[2]=0,e[this.longAxis_(g)]=1)},checkOrientation_:function(){var e,t,n=this.mesh.fHead,i,r=this.mesh.vHead,a;for(e=0,t=n.next;t!==n;t=t.next)if(a=t.anEdge,!(a.winding<=0))do e+=(a.Org.s-a.Dst.s)*(a.Org.t+a.Dst.t),a=a.Lnext;while(a!==t.anEdge);if(e<0){for(i=r.next;i!==r;i=i.next)i.t=-i.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},projectPolygon_:function(){var e,t=this.mesh.vHead,n=[0,0,0],i,r,a,o,s=!1;for(n[0]=this.normal[0],n[1]=this.normal[1],n[2]=this.normal[2],n[0]===0&&n[1]===0&&n[2]===0&&(this.computeNormal_(n),s=!0),i=this.sUnit,r=this.tUnit,a=this.longAxis_(n),i[a]=0,i[(a+1)%3]=1,i[(a+2)%3]=0,r[a]=0,r[(a+1)%3]=0,r[(a+2)%3]=n[a]>0?1:-1,e=t.next;e!==t;e=e.next)e.s=this.dot_(e.coords,i),e.t=this.dot_(e.coords,r);for(s&&this.checkOrientation_(),o=!0,e=t.next;e!==t;e=e.next)o?(this.bmin[0]=this.bmax[0]=e.s,this.bmin[1]=this.bmax[1]=e.t,o=!1):(e.s<this.bmin[0]&&(this.bmin[0]=e.s),e.s>this.bmax[0]&&(this.bmax[0]=e.s),e.t<this.bmin[1]&&(this.bmin[1]=e.t),e.t>this.bmax[1]&&(this.bmax[1]=e.t))},addWinding_:function(e,t){e.winding+=t.winding,e.Sym.winding+=t.Sym.winding},tessellateMonoRegion_:function(e,t){var n,i;for(n=t.anEdge,h(n.Lnext!==n&&n.Lnext.Lnext!==n);f.vertLeq(n.Dst,n.Org);n=n.Lprev);for(;f.vertLeq(n.Org,n.Dst);n=n.Lnext);for(i=n.Lprev;n.Lnext!==i;)if(f.vertLeq(n.Dst,i.Org)){for(;i.Lnext!==n&&(f.edgeGoesLeft(i.Lnext)||f.edgeSign(i.Org,i.Dst,i.Lnext.Dst)<=0);){var r=e.connect(i.Lnext,i);i=r.Sym}i=i.Lprev}else{for(;i.Lnext!=n&&(f.edgeGoesRight(n.Lprev)||f.edgeSign(n.Dst,n.Org,n.Lprev.Org)>=0);){var r=e.connect(n,n.Lprev);n=r.Sym}n=n.Lnext}for(h(i.Lnext!==n);i.Lnext.Lnext!==n;){var r=e.connect(i.Lnext,i);i=r.Sym}return!0},tessellateInterior_:function(e){var t,n;for(t=e.fHead.next;t!==e.fHead;t=n)if(n=t.next,t.inside&&!this.tessellateMonoRegion_(e,t))return!1;return!0},discardExterior_:function(e){var t,n;for(t=e.fHead.next;t!==e.fHead;t=n)n=t.next,t.inside||e.zapFace(t)},setWindingNumber_:function(e,t,n){var i,r;for(i=e.eHead.next;i!==e.eHead;i=r)r=i.next,i.Rface.inside!==i.Lface.inside?i.winding=i.Lface.inside?t:-t:n?e.delete(i):i.winding=0},getNeighbourFace_:function(e){return!e.Rface||!e.Rface.inside?-1:e.Rface.n},outputPolymesh_:function(e,t,n,i){var r,a,o,s=0,d=0,g,u;for(n>3&&e.mergeConvexFaces(n),r=e.vHead.next;r!==e.vHead;r=r.next)r.n=-1;for(a=e.fHead.next;a!=e.fHead;a=a.next)if(a.n=-1,!!a.inside){o=a.anEdge,g=0;do r=o.Org,r.n===-1&&(r.n=d,d++),g++,o=o.Lnext;while(o!==a.anEdge);h(g<=n),a.n=s,++s}for(this.elementCount=s,t==x.CONNECTED_POLYGONS&&(s*=2),this.elements=[],this.elements.length=s*n,this.vertexCount=d,this.vertices=[],this.vertices.length=d*i,this.vertexIndices=[],this.vertexIndices.length=d,r=e.vHead.next;r!==e.vHead;r=r.next)if(r.n!=-1){var c=r.n*i;this.vertices[c+0]=r.coords[0],this.vertices[c+1]=r.coords[1],i>2&&(this.vertices[c+2]=r.coords[2]),this.vertexIndices[r.n]=r.idx}var m=0;for(a=e.fHead.next;a!==e.fHead;a=a.next)if(a.inside){o=a.anEdge,g=0;do r=o.Org,this.elements[m++]=r.n,g++,o=o.Lnext;while(o!==a.anEdge);for(u=g;u<n;++u)this.elements[m++]=-1;if(t==x.CONNECTED_POLYGONS){o=a.anEdge;do this.elements[m++]=this.getNeighbourFace_(o),o=o.Lnext;while(o!==a.anEdge);for(u=g;u<n;++u)this.elements[m++]=-1}}},outputContours_:function(e,t){var n,i,r,a=0,o=0;for(this.vertexCount=0,this.elementCount=0,n=e.fHead.next;n!==e.fHead;n=n.next)if(n.inside){r=i=n.anEdge;do this.vertexCount++,i=i.Lnext;while(i!==r);this.elementCount++}this.elements=[],this.elements.length=this.elementCount*2,this.vertices=[],this.vertices.length=this.vertexCount*t,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var s=0,d=0,g=0;for(a=0,n=e.fHead.next;n!==e.fHead;n=n.next)if(n.inside){o=0,r=i=n.anEdge;do this.vertices[s++]=i.Org.coords[0],this.vertices[s++]=i.Org.coords[1],t>2&&(this.vertices[s++]=i.Org.coords[2]),this.vertexIndices[d++]=i.Org.idx,o++,i=i.Lnext;while(i!==r);this.elements[g++]=a,this.elements[g++]=o,a+=o}},addContour:function(e,t){var n,i;for(this.mesh===null&&(this.mesh=new R),e<2&&(e=2),e>3&&(e=3),n=null,i=0;i<t.length;i+=e)n==null?(n=this.mesh.makeEdge(),this.mesh.splice(n,n.Sym)):(this.mesh.splitEdge(n),n=n.Lnext),n.Org.coords[0]=t[i+0],n.Org.coords[1]=t[i+1],e>2?n.Org.coords[2]=t[i+2]:n.Org.coords[2]=0,n.Org.idx=this.vertexIndexCounter++,n.winding=1,n.Sym.winding=-1},tesselate:function(e,t,n,i,r){if(this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,r&&(this.normal[0]=r[0],this.normal[1]=r[1],this.normal[2]=r[2]),this.windingRule=e,i<2&&(i=2),i>3&&(i=3),!this.mesh)return!1;this.projectPolygon_(),l.computeInterior(this);var a=this.mesh;return t==x.BOUNDARY_CONTOURS?this.setWindingNumber_(a,1,!0):this.tessellateInterior_(a),a.check(),t==x.BOUNDARY_CONTOURS?this.outputContours_(a,i):this.outputPolymesh_(a,t,n,i),!0}};var S=U,C=H(S),V=I({__proto__:null,default:C},[S]);console.log("¡¡¡WORKER DE TESSELLATION CARGADO - VERSIÓN 3!!!");self.onmessage=e=>{const{id:t,contours:n,winding:i}=e.data;try{const r=[];for(const c of n){if(!c||c.length<3)continue;const m=new Float32Array(c.length*2);for(let p=0;p<c.length;p++)m[p*2]=c[p].x,m[p*2+1]=c[p].y;r.push(m)}if(r.length===0){self.postMessage({id:t,positions:new Float32Array,indices:new Uint32Array});return}const a=S.tesselate({contours:r,windingRule:V[i==="odd"?"WINDING_ODD":"WINDING_NONZERO"],elementType:S.POLYGONS,polygonSize:3,vertexSize:2}),o=a.vertices,s=a.elements,d=[];for(let c=0;c<s.length;c++)s[c]>=0&&d.push(s[c]);const g=new Float32Array(o),u=new Uint32Array(d);self.postMessage({id:t,positions:g,indices:u},[g.buffer,u.buffer])}catch(r){console.error("tess.worker error",r),self.postMessage({id:t,positions:new Float32Array,indices:new Uint32Array,error:String(r)})}};
